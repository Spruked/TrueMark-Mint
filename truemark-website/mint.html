<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mint Certificate - TrueMark Mint</title>
    <link rel="icon" type="image/x-icon" href="assets/img/bryan-spruk.png">
    <link rel="stylesheet" href="assets/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="assets/img/treumarkbrown1600.png" alt="TrueMark Mint Logo">
                <span>TrueMark Mint</span>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">Home</a>
                </li>
                <li class="nav-item">
                    <a href="about.html" class="nav-link">About</a>
                </li>
                <li class="nav-item">
                    <a href="how.html" class="nav-link">How It Works</a>
                </li>
                <li class="nav-item">
                    <a href="mint.html" class="nav-link active">Mint</a>
                </li>
                <li class="nav-item">
                    <a href="demo-mint.html" class="nav-link demo-link">Demo Mint</a>
                </li>
                <li class="nav-item">
                    <a href="contact.html" class="nav-link">Contact</a>
                </li>
            </ul>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1>Create Your Digital Certificate</h1>
            <p>Secure your digital assets with blockchain-powered authentication</p>
        </div>
    </section>

    <!-- Demo Mode Banner -->
    <div id="demo-banner" class="demo-banner" style="display: none;">
        <div class="container">
            <div class="demo-banner-content">
                <span class="demo-icon">üöÄ</span>
                <strong>Demo Mode Active</strong>
                <span class="demo-text">You are viewing the mint interface in demo mode. All features are available for testing.</span>
                <a href="login.html" class="demo-login-link">Login for Full Access</a>
            </div>
        </div>
    </div>

    <!-- Mint Form Section -->
    <section class="mint-form-section">
        <div class="container">
            <div class="mint-container">
                <!-- Progress Steps -->
                <div class="progress-steps">
                    <div class="step active" data-step="1">
                        <div class="step-number">1</div>
                        <div class="step-label">Upload File</div>
                    </div>
                    <div class="progress-line"></div>
                    <div class="step" data-step="2">
                        <div class="step-number">2</div>
                        <div class="step-label">Add Details</div>
                    </div>
                    <div class="progress-line"></div>
                    <div class="step" data-step="3">
                        <div class="step-number">3</div>
                        <div class="step-label">Review & Mint</div>
                    </div>
                    <div class="progress-line"></div>
                    <div class="step" data-step="4">
                        <div class="step-number">4</div>
                        <div class="step-label">Certificate</div>
                    </div>
                </div>

                <!-- Step 1: File Upload -->
                <div class="form-step active" id="step-1">
                    <div class="step-content">
                        <h2>Select Your NFT Type</h2>
                        <p>Choose the type of NFT certificate that best fits your needs</p>
                        
                        <div class="nft-type-selection">
                                                    <div class="minting-options">
                            <div class="pricing-phase-indicator entry">Entry Phase Pricing</div>
                            
                            <!-- Payment Method Selection -->
                            <div class="payment-method-selector">
                                <h3>Choose Payment Method</h3>
                                <div class="payment-methods">
                                    <button class="payment-method active" data-method="crypto" onclick="selectPaymentMethod('crypto')">
                                        <div class="method-icon">üè¶</div>
                                        <div class="method-info">
                                            <h4>Cryptocurrency</h4>
                                            <p>Pay with MATIC or ETH via MetaMask</p>
                                        </div>
                                    </button>
                                    <button class="payment-method" data-method="card" onclick="selectPaymentMethod('card')">
                                        <div class="method-icon">üí≥</div>
                                        <div class="method-info">
                                            <h4>Credit/Debit Card</h4>
                                            <p>Pay with card via Square</p>
                                        </div>
                                    </button>
                                </div>
                            </div>

                            <!-- Crypto Payment Options -->
                            <div class="crypto-payment-section" id="cryptoPaymentSection">
                                <div class="wallet-connection">
                                    <button class="btn btn-wallet" id="connectWallet" onclick="connectWallet()">
                                        Connect MetaMask Wallet
                                    </button>
                                    <div class="wallet-info" id="walletInfo" style="display: none;"></div>
                                </div>

                                <div class="network-selection">
                                    <h4>Select Network</h4>
                                    <div class="network-options">
                                        <button class="network-selector active" data-network="polygon" onclick="switchNetwork('polygon')">
                                            <span class="network-icon">üü£</span>
                                            <div class="network-details">
                                                <strong>Polygon</strong>
                                                <small>Lower fees, recommended for personal use</small>
                                            </div>
                                        </button>
                                        <button class="network-selector" data-network="ethereum" onclick="switchNetwork('ethereum')">
                                            <span class="network-icon">üíé</span>
                                            <div class="network-details">
                                                <strong>Ethereum</strong>
                                                <small>Higher security, recommended for enterprise</small>
                                            </div>
                                        </button>
                                    </div>
                                </div>

                                <div class="pricing-phase-selection">
                                    <h4>Select Pricing Phase</h4>
                                    <div class="phase-options">
                                        <button class="phase-selector active" data-phase="entry" onclick="switchPhase('entry')">
                                            <div class="phase-info">
                                                <strong>Entry Phase</strong>
                                                <small>Basic NFT features</small>
                                                <div class="phase-price">0.01 ETH / 15 MATIC</div>
                                            </div>
                                        </button>
                                        <button class="phase-selector" data-phase="premium" onclick="switchPhase('premium')">
                                            <div class="phase-info">
                                                <strong>Premium Phase</strong>
                                                <small>Enhanced features + royalty benefits</small>
                                                <div class="phase-price">0.05 ETH / 75 MATIC</div>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Card Payment Section -->
                            <div class="card-payment-section" id="cardPaymentSection" style="display: none;">
                                <div class="square-payment-form">
                                    <h4>Credit/Debit Card Payment</h4>
                                    <div id="card-container"></div>
                                    <div class="payment-security">
                                        <small>üîí Secured by Square - Your payment information is encrypted and secure</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                            
                            <div class="nft-types-grid" id="nftTypesGrid">
                                <!-- NFT type cards will be dynamically generated -->
                            </div>
                        </div>

                        <div class="step-actions">
                            <button class="btn btn-primary" id="nextStep1" disabled>Continue to Upload</button>
                        </div>
                    </div>
                </div>

                <div class="form-step" id="step-2">
                    <div class="step-content">
                        <h2>Upload Your Digital Asset</h2>
                        <p>Select the file you want to authenticate. We support all major file formats.</p>
                        
                        <div class="file-upload-area" id="fileUploadArea">
                            <div class="upload-icon">üìÅ</div>
                            <div class="upload-text">
                                <h3>Drag and drop your file here</h3>
                                <p>or <span class="upload-link">click to browse</span></p>
                            </div>
                            <input type="file" id="fileInput" accept="*/*" style="display: none;">
                        </div>

                        <div class="file-info" id="fileInfo" style="display: none;">
                            <div class="file-details">
                                <div class="file-icon">üìÑ</div>
                                <div class="file-meta">
                                    <div class="file-name" id="fileName"></div>
                                    <div class="file-size" id="fileSize"></div>
                                    <div class="file-type" id="fileType"></div>
                                </div>
                                <button class="remove-file" id="removeFile">√ó</button>
                            </div>
                        </div>

                        <div class="supported-formats">
                            <h4>Supported Formats:</h4>
                            <div class="format-tags">
                                <span class="format-tag">Images (JPG, PNG, GIF, SVG)</span>
                                <span class="format-tag">Documents (PDF, DOC, TXT)</span>
                                <span class="format-tag">Videos (MP4, AVI, MOV)</span>
                                <span class="format-tag">Audio (MP3, WAV, FLAC)</span>
                                <span class="format-tag">Code (JS, HTML, CSS, PY)</span>
                                <span class="format-tag">Archives (ZIP, RAR, 7Z)</span>
                            </div>
                        </div>

                        <div class="step-actions">
                            <button class="btn btn-secondary" id="prevStep2">Back to NFT Type</button>
                            <button class="btn btn-primary" id="nextStep2" disabled>Continue to Details</button>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Asset Details -->
                <div class="form-step" id="step-3">
                    <div class="step-content">
                        <h2>Add Asset Details</h2>
                        <p>Provide information about your digital asset for the certificate.</p>
                        
                        <form class="asset-form" id="assetForm">
                            <div class="form-group">
                                <label for="assetTitle">Asset Title *</label>
                                <input type="text" id="assetTitle" name="assetTitle" required 
                                       placeholder="Enter a descriptive title for your asset">
                            </div>

                            <div class="form-group">
                                <label for="assetDescription">Description</label>
                                <textarea id="assetDescription" name="assetDescription" rows="4"
                                         placeholder="Describe your digital asset (optional)"></textarea>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="creatorName">Creator Name *</label>
                                    <input type="text" id="creatorName" name="creatorName" required
                                           placeholder="Your name or organization">
                                </div>
                                <div class="form-group">
                                    <label for="creatorEmail">Email Address *</label>
                                    <input type="email" id="creatorEmail" name="creatorEmail" required
                                           placeholder="your@email.com">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="assetCategory">Category</label>
                                    <select id="assetCategory" name="assetCategory">
                                        <option value="">Select category</option>
                                        <option value="art">Digital Art</option>
                                        <option value="document">Document</option>
                                        <option value="music">Music/Audio</option>
                                        <option value="video">Video</option>
                                        <option value="software">Software/Code</option>
                                        <option value="research">Research/Academic</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="assetLicense">License Type</label>
                                    <select id="assetLicense" name="assetLicense">
                                        <option value="">Select license</option>
                                        <option value="copyright">All Rights Reserved</option>
                                        <option value="cc-by">Creative Commons - Attribution</option>
                                        <option value="cc-by-sa">Creative Commons - Attribution-ShareAlike</option>
                                        <option value="cc-by-nc">Creative Commons - Attribution-NonCommercial</option>
                                        <option value="mit">MIT License</option>
                                        <option value="gpl">GNU General Public License</option>
                                        <option value="custom">Custom License</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-section network-selection">
                                <h3>Blockchain Network</h3>
                                <p>Choose the blockchain network for your NFT certificate</p>
                                
                                <div class="network-options">
                                    <div class="network-option" data-network="polygon">
                                        <div class="network-header">
                                            <div class="network-icon">üü£</div>
                                            <div class="network-info">
                                                <h4>Polygon Network</h4>
                                                <span class="network-badge personal">Personal Use</span>
                                            </div>
                                            <input type="radio" name="network" value="polygon" id="networkPolygon" checked>
                                        </div>
                                        <div class="network-details">
                                            <ul>
                                                <li>üí∞ Lower gas fees (~$0.01-0.10)</li>
                                                <li>‚ö° Fast transactions (2-3 seconds)</li>
                                                <li>üå± Eco-friendly (99% less energy)</li>
                                                <li>üë§ Perfect for personal projects</li>
                                            </ul>
                                        </div>
                                    </div>

                                    <div class="network-option" data-network="ethereum">
                                        <div class="network-header">
                                            <div class="network-icon">üíé</div>
                                            <div class="network-info">
                                                <h4>Ethereum Network</h4>
                                                <span class="network-badge enterprise">Enterprise</span>
                                            </div>
                                            <input type="radio" name="network" value="ethereum" id="networkEthereum">
                                        </div>
                                        <div class="network-details">
                                            <ul>
                                                <li>üèõÔ∏è Maximum security & decentralization</li>
                                                <li>üåê Largest NFT ecosystem</li>
                                                <li>üìà Higher resale value potential</li>
                                                <li>üè¢ Ideal for enterprise & commercial use</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="additionalNotes">Additional Notes</label>
                                <textarea id="additionalNotes" name="additionalNotes" rows="3"
                                         placeholder="Any additional information about this asset"></textarea>
                            </div>

                            <div class="form-group checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="termsAccept" name="termsAccept" required>
                                    <span class="checkmark"></span>
                                    I confirm that I own the rights to this digital asset and agree to the 
                                    <a href="terms.html" target="_blank">Terms of Service</a>
                                </label>
                            </div>
                        </form>

                        <div class="step-actions">
                            <button class="btn btn-secondary" id="prevStep2">Back</button>
                            <button class="btn btn-primary" id="nextStep2" disabled>Review & Mint</button>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Review & Mint -->
                <div class="form-step" id="step-3">
                    <div class="step-content">
                        <h2>Review Your Information</h2>
                        <p>Please review all details before creating your certificate.</p>
                        
                        <div class="review-sections">
                            <div class="review-section">
                                <h3>File Information</h3>
                                <div class="review-grid">
                                    <div class="review-item">
                                        <span class="review-label">File Name:</span>
                                        <span class="review-value" id="reviewFileName"></span>
                                    </div>
                                    <div class="review-item">
                                        <span class="review-label">File Size:</span>
                                        <span class="review-value" id="reviewFileSize"></span>
                                    </div>
                                    <div class="review-item">
                                        <span class="review-label">File Type:</span>
                                        <span class="review-value" id="reviewFileType"></span>
                                    </div>
                                    <div class="review-item">
                                        <span class="review-label">File Hash:</span>
                                        <span class="review-value hash" id="reviewFileHash">Calculating...</span>
                                    </div>
                                </div>
                            </div>

                            <div class="review-section">
                                <h3>Asset Details</h3>
                                <div class="review-grid">
                                    <div class="review-item">
                                        <span class="review-label">Title:</span>
                                        <span class="review-value" id="reviewTitle"></span>
                                    </div>
                                    <div class="review-item">
                                        <span class="review-label">Creator:</span>
                                        <span class="review-value" id="reviewCreator"></span>
                                    </div>
                                    <div class="review-item">
                                        <span class="review-label">Email:</span>
                                        <span class="review-value" id="reviewEmail"></span>
                                    </div>
                                    <div class="review-item">
                                        <span class="review-label">Category:</span>
                                        <span class="review-value" id="reviewCategory"></span>
                                    </div>
                                    <div class="review-item">
                                        <span class="review-label">License:</span>
                                        <span class="review-value" id="reviewLicense"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="pricing-section">
                                <h3>Alpha CertSig Pricing</h3>
                                <div class="price-breakdown">
                                    <div class="price-item">
                                        <span>NFT Minting (Entry Phase)</span>
                                        <span>15 MATIC</span>
                                    </div>
                                    <div class="price-item">
                                        <span>Network Fees (Polygon)</span>
                                        <span>~0.01 MATIC</span>
                                    </div>
                                    <div class="price-item royalty-info">
                                        <span>Future Royalties</span>
                                        <span>1.5% resale / 3% licensing</span>
                                    </div>
                                    <div class="price-item total">
                                        <span>Total</span>
                                        <span>15 MATIC (~$7)</span>
                                    </div>
                                </div>
                                <div class="pricing-note">
                                    <small>üí° <strong>Alpha CertSig Benefits:</strong> Your NFT includes resale royalties (1.5%) and licensing royalties (3%) that provide ongoing value from your digital assets.</small>
                                </div>
                            </div>
                        </div>

                        <div class="step-actions">
                            <button class="btn btn-secondary" id="prevStep3">Back</button>
                            <button class="btn btn-primary btn-large" id="mintCertificate" onclick="processPayment('crypto')">
                                <span class="mint-text">Mint Certificate - 15 MATIC (~$7)</span>
                                <span class="network-badge">Polygon</span>
                            </button>
                                <span class="loading-text" style="display: none;">Processing...</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Certificate Complete -->
                <div class="form-step" id="step-4">
                    <div class="step-content">
                        <div class="success-animation">
                            <div class="success-icon">‚úÖ</div>
                            <h2>Certificate Created Successfully!</h2>
                            <p>Your digital asset has been authenticated and recorded on the blockchain.</p>
                        </div>

                        <div class="certificate-preview">
                            <div class="cert-header">
                                <img src="assets/img/treumarkbrown1600.png" alt="TrueMark Logo" class="cert-logo">
                                <h3>TrueMark Digital Certificate</h3>
                            </div>
                            <div class="cert-body">
                                <div class="cert-field">
                                    <label>Certificate ID:</label>
                                    <span id="certificateId">TM-2025-001234567</span>
                                </div>
                                <div class="cert-field">
                                    <label>Asset Title:</label>
                                    <span id="certAssetTitle"></span>
                                </div>
                                <div class="cert-field">
                                    <label>Creator:</label>
                                    <span id="certCreator"></span>
                                </div>
                                <div class="cert-field">
                                    <label>Timestamp:</label>
                                    <span id="certTimestamp"></span>
                                </div>
                                <div class="cert-field">
                                    <label>Blockchain Transaction:</label>
                                    <span id="certTransaction" class="hash">0x1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d</span>
                                </div>
                                <div class="cert-qr">
                                    <div class="qr-code" id="qrCode">
                                        <div class="qr-placeholder">üì± QR Code</div>
                                    </div>
                                    <p>Scan to verify certificate</p>
                                </div>
                            </div>
                        </div>

                        <div class="certificate-actions">
                            <button class="btn btn-primary" id="downloadCert">Download Certificate</button>
                            <button class="btn btn-secondary" id="shareCert">Share Certificate</button>
                            <button class="btn btn-outline" id="verifyCert">Verify Certificate</button>
                        </div>

                        <div class="next-steps">
                            <h3>What's Next?</h3>
                            <ul>
                                <li>‚úÖ Your certificate is now available in your dashboard</li>
                                <li>üìß A copy has been sent to your email address</li>
                                <li>üîó Use the verification link to prove authenticity</li>
                                <li>üì± Share the QR code for quick verification</li>
                            </ul>
                        </div>

                        <div class="step-actions">
                            <button class="btn btn-primary" onclick="window.location.href='mint.html'">Create Another Certificate</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Trust Indicators -->
    <section class="trust-indicators">
        <div class="container">
            <div class="trust-grid">
                <div class="trust-item">
                    <div class="trust-icon">üîí</div>
                    <h4>Bank-Level Security</h4>
                    <p>256-bit encryption protects your data</p>
                </div>
                <div class="trust-item">
                    <div class="trust-icon">‚ö°</div>
                    <h4>Instant Processing</h4>
                    <p>Certificates generated in under 5 minutes</p>
                </div>
                <div class="trust-item">
                    <div class="trust-icon">üåç</div>
                    <h4>Global Verification</h4>
                    <p>Recognized worldwide on public blockchain</p>
                </div>
                <div class="trust-item">
                    <div class="trust-icon">üí∞</div>
                    <h4>No Hidden Fees</h4>
                    <p>Transparent pricing with no surprises</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <img src="assets/img/treumarkbrown1600.png" alt="TrueMark Mint Logo">
                        <span>TrueMark Mint</span>
                    </div>
                    <p>Securing digital assets with blockchain technology</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="about.html">About</a></li>
                        <li><a href="how.html">How It Works</a></li>
                        <li><a href="mint.html">Mint</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href="privacy.html">Privacy Policy</a></li>
                        <li><a href="terms.html">Terms of Service</a></li>
                        <li><a href="cookies.html">Cookie Policy</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Connect</h4>
                    <ul>
                        <li><a href="#">Twitter</a></li>
                        <li><a href="#">LinkedIn</a></li>
                        <li><a href="#">GitHub</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>Certified by Alpha CertSig Mint</p>
                <p>&copy; 2025 TrueMark LLC, an affiliate of Pro Prime Holdings.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
    <script src="assets/js/error-handler.js"></script>
    <script src="assets/js/env-config.js"></script>
    <script src="assets/js/config-loader.js"></script>
    <script src="assets/js/payment-config.js"></script>
    <script src="assets/js/network-config.js"></script>
    <script src="assets/js/nft-taxonomy.js"></script>
    <script src="assets/js/integrations.js"></script>
    <script src="assets/js/usd-crypto-pricing.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/mint.js"></script>
    
    <script>
        // Authentication check for mint page
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // Check if user is authenticated
                const token = localStorage.getItem('truemark_token');
                const user = localStorage.getItem('truemark_user');

                if (token && user) {
                    // Check if it's a demo token (starts with 'demo_')
                    if (token.startsWith('demo_')) {
                        console.log('Demo authentication detected, allowing access');
                        // Set auth state for demo mode
                        authState.isAuthenticated = true;
                        authState.token = token;
                        authState.user = JSON.parse(user);
                    } else {
                        // Verify real token with backend
                        const authResult = await WalletAuth.verifyAuthentication();
                        if (!authResult.authenticated) {
                            window.location.href = 'login.html';
                            return;
                        }
                    }
                } else {
                    // Check if demo mode is requested
                    const urlParams = new URLSearchParams(window.location.search);
                    const isDemoMode = urlParams.get('demo') === 'true';

                    if (!isDemoMode) {
                        // Not authenticated and not demo mode, redirect to login
                        window.location.href = 'login.html';
                        return;
                    }
                }

                // User is authenticated or in demo mode, proceed with mint page initialization
                console.log('Authentication verified, initializing mint page');

            } catch (error) {
                console.error('Authentication check failed:', error);
                // On error, check for demo token
                const token = localStorage.getItem('truemark_token');
                if (token && token.startsWith('demo_')) {
                    console.log('Demo token found despite error, allowing access');
                    authState.isAuthenticated = true;
                } else {
                    // Redirect to login unless in demo mode
                    const urlParams = new URLSearchParams(window.location.search);
                    if (urlParams.get('demo') !== 'true') {
                        window.location.href = 'login.html';
                    }
                }
            }
        });
    </script>

    <script>
        // Initialize USD-based crypto pricing system
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Initializing USD-based payment system...');
            
            // Wait for payment manager to be ready
            if (window.usdPaymentManager) {
                await window.usdPaymentManager.initialize();
                console.log('‚úÖ USD Payment Manager ready');
                
                // Setup enhanced pricing display
                setupEnhancedPricing();
            }
        });
        
        function setupEnhancedPricing() {
            // Listen for real-time price updates
            document.addEventListener('pricesUpdated', () => {
                console.log('üí∞ Crypto prices updated, refreshing displays...');
                updateAllPricingDisplays();
            });
            
            // Listen for network/phase changes
            document.addEventListener('paymentConfigChanged', updateAllPricingDisplays);
            
            // Initial update
            updateAllPricingDisplays();
        }
        
        function updateAllPricingDisplays() {
            if (!window.usdPaymentManager) return;
            
            try {
                const network = paymentState.selectedNetwork || 'polygon';
                const isBasic = paymentState.selectedPhase !== 'premium';
                const productType = isBasic ? 'nft_basic' : 'nft_premium';
                
                // Get current pricing
                const pricing = window.usdPaymentManager.getProductPricing(productType, network);
                
                // Update pricing breakdown display
                updatePricingBreakdown(pricing);
                
                // Update mint button
                updateMintButton(pricing, network);
                
                // Update phase indicator
                updatePhaseIndicator(pricing);
                
            } catch (error) {
                console.error('‚ùå Error updating pricing displays:', error);
                showFallbackPricing();
            }
        }
        
        function updatePricingBreakdown(pricing) {
            const priceDisplay = document.querySelector('.price-breakdown');
            if (!priceDisplay) return;
            
            const lastUpdate = new Date(pricing.lastUpdate).toLocaleTimeString();
            
            priceDisplay.innerHTML = `
                <div class="price-item">
                    <span>üéØ NFT Certificate (${pricing.productType.replace('nft_', '').toUpperCase()})</span>
                    <span><strong>$${pricing.usdPrice}</strong></span>
                </div>
                <div class="price-item">
                    <span>üíé Crypto Amount (${pricing.cryptoSymbol})</span>
                    <span>${pricing.cryptoAmount} ${pricing.cryptoSymbol}</span>
                </div>
                <div class="price-item">
                    <span>üìà Current ${pricing.cryptoSymbol} Rate</span>
                    <span>$${pricing.pricePerToken} <small>(${lastUpdate})</small></span>
                </div>
                <div class="price-item">
                    <span>‚õΩ Estimated Gas Fee</span>
                    <span>~${pricing.gasFeeEstimate.amount} ${pricing.gasFeeEstimate.symbol} (~$${pricing.gasFeeEstimate.usd})</span>
                </div>
                <div class="price-item royalty-info">
                    <span>üí∞ Future Royalties</span>
                    <span>1.5% resale / 3% licensing</span>
                </div>
                <div class="price-item total">
                    <span><strong>Total Payment</strong></span>
                    <span><strong>${pricing.cryptoAmount} ${pricing.cryptoSymbol} ($${pricing.usdPrice})</strong></span>
                </div>
                <div class="pricing-note">
                    <small>üí° <strong>How you get paid:</strong> Customer pays ${pricing.cryptoAmount} ${pricing.cryptoSymbol} (worth exactly $${pricing.usdPrice}) directly to your wallet. No gas fees for you!</small>
                </div>
            `;
        }
        
        function updateMintButton(pricing, network) {
            const mintButton = document.getElementById('mintCertificate');
            if (!mintButton) return;
            
            mintButton.innerHTML = `
                <span class="mint-text">üí≥ Pay ${pricing.cryptoAmount} ${pricing.cryptoSymbol} ($${pricing.usdPrice})</span>
                <span class="network-badge">${network.toUpperCase()}</span>
            `;
        }
        
        function updatePhaseIndicator(pricing) {
            const indicator = document.querySelector('.pricing-phase-indicator');
            if (!indicator) return;
            
            const phase = pricing.productType.includes('premium') ? 'premium' : 'basic';
            indicator.className = `pricing-phase-indicator ${phase}`;
            indicator.textContent = `${phase.toUpperCase()} - $${pricing.usdPrice} USD`;
        }
        
        function showFallbackPricing() {
            const priceDisplay = document.querySelector('.price-breakdown');
            if (priceDisplay) {
                priceDisplay.innerHTML = `
                    <div class="price-item total">
                        <span>‚ö†Ô∏è Pricing Unavailable</span>
                        <span>Please refresh page</span>
                    </div>
                `;
            }
        }
        
        // Enhanced mint function with real USD conversion
        async function mintWithUSDConversion() {
            if (!window.usdPaymentManager) {
                alert('üí∏ Payment system loading... Please wait a moment and try again.');
                return;
            }
            
            const paymentMethod = paymentState.selectedMethod;
            const network = paymentState.selectedNetwork || 'polygon';
            const productType = paymentState.selectedPhase === 'premium' ? 'nft_premium' : 'nft_basic';
            
            try {
                const pricing = window.usdPaymentManager.getProductPricing(productType, network);
                
                // Show detailed pricing confirmation
                const confirmed = confirm(
                    `üí∞ PAYMENT CONFIRMATION\n\n` +
                    `üì¶ Product: ${productType.replace('nft_', '').toUpperCase()} NFT Certificate\n` +
                    `üíµ USD Price: $${pricing.usdPrice}\n` +
                    `üíé You Pay: ${pricing.cryptoAmount} ${pricing.cryptoSymbol}\n` +
                    `üåê Network: ${network.toUpperCase()}\n` +
                    `‚õΩ Gas Fee: ~$${pricing.gasFeeEstimate.usd}\n` +
                    `üìà ${pricing.cryptoSymbol} Rate: $${pricing.pricePerToken}\n\n` +
                    `üéØ Your wallet receives exactly $${pricing.usdPrice} worth of crypto!\n\n` +
                    `Continue with payment?`
                );
                
                if (!confirmed) return;
                
                if (paymentMethod === 'crypto') {
                    // Process crypto payment
                    showPaymentProcessing();
                    
                    const result = await window.usdPaymentManager.processCryptoPayment(
                        productType,
                        network,
                        paymentState.walletAddress
                    );
                    
                    hidePaymentProcessing();
                    
                    if (result.success) {
                        showPaymentSuccess(result);
                    } else {
                        showPaymentError(result.error);
                    }
                } else {
                    // Card payment - always charges exact USD amount
                    alert(`üí≥ Card Payment: $${pricing.usdPrice}\n\nYou'll be charged exactly $${pricing.usdPrice} via Square payment processor.`);
                    // Process Square payment with exact USD amount
                }
                
            } catch (error) {
                console.error('‚ùå Payment error:', error);
                alert('üö´ Payment Error: ' + error.message);
            }
        }
        
        function showPaymentProcessing() {
            const notification = document.createElement('div');
            notification.className = 'payment-notification processing';
            notification.innerHTML = '‚è≥ Processing payment...';
            document.body.appendChild(notification);
        }
        
        function hidePaymentProcessing() {
            document.querySelector('.payment-notification.processing')?.remove();
        }
        
        function showPaymentSuccess(result) {
            alert(
                `‚úÖ PAYMENT SUCCESSFUL!\n\n` +
                `üéØ Transaction Hash: ${result.transactionHash}\n` +
                `üíé Amount Paid: ${result.pricing.cryptoAmount} ${result.pricing.cryptoSymbol}\n` +
                `üíµ USD Value: $${result.pricing.usdPrice}\n\n` +
                `Your NFT certificate is being minted! üöÄ`
            );
        }
        
        function showPaymentError(error) {
            alert(`‚ùå Payment Failed: ${error}\n\nPlease try again or contact support.`);
        }
    </script>

    <!-- TrueMark Mint Seal -->
    <div class="truemark-seal">
        <img src="assets/img/TrueMarkMintseal.png" alt="TrueMark Mint Seal" class="seal-image">
    </div>
</body>
</html>